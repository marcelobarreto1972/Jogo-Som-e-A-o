<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jogo Som e Ação</title>
    <style>
      body {
        font-family: "Fantasy";
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: black;
        color: rgb(224, 188, 32);
      }
      #initial-screen,
      #game-play-screen,
      #challenge-screen,
      #screen-4 {
        display: none;
        text-align: center;
        width: 100%;
        height: 100vh;
      }
      #challenge-screen {
        background-color: black;
        position: relative;
      }
      #screen-4 {
        background-color: #111;
        color: #eee;
        padding: 20px;
      }
      #player-name-display {
        position: absolute;
        top: 10px;
        right: 10px;
        font-family: Fantasy;
        font-weight: bold;
        font-size: 20px;
        color: rgb(224, 188, 32);
        z-index: 1001;
        animation: glow 2s infinite alternate;
      }
      #scoreboard {
        position: absolute;
        top: 50px;
        left: 1150px;
        font-family: Fantasy;
        font-weight: bold;
        font-size: 55px;
        color: rgb(0, 128, 0);
        border-radius: 8px;
        user-select: none;        
        z-index: 1001;
      }

      @keyframes glow {
        0% {
          text-shadow: 0 0 5px rgb(224, 188, 32);
          color: rgb(224, 188, 32);
        }
        100% {
          text-shadow: 0 0 20px rgb(255, 215, 0);
          color: rgb(255, 215, 0);
        }
      }
      #player-name-display {
        position: absolute;
        top: 10px;
        right: 50px;
        font-family: Fantasy;
        font-weight: bold;
        font-size: 50px;     
        color: rgb(77, 208, 240);
        z-index: 1001;
      }
      input {
        margin: 5px;
        padding: 10px;
        font-size: 16px;
        color: black;
        border: 2px solid rgb(224, 188, 32);
        border-radius: 8px;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }
      #playerName {
        margin-top: 60px;
      }
      #sequence-table .seq-input {
        text-align: center;
        font-weight: bold;
        font-size: 14px;
      }
      #sequence-table-3 .seq-input {
        text-align: center;
        font-weight: bold;
        font-size: 18px;
        height: 30px;
        line-height: 30px;
        padding: 0;
      }
      #sequence-table-4 .seq-input {
        text-align: center;
        font-weight: bold;
        font-size: 18px;
        height: 30px;
        line-height: 30px;
        padding: 0;
      }
      input:focus {
        border-color: rgb(255, 215, 0);
        box-shadow: 0 0 8px rgb(255, 215, 0);
        outline: none;
      }
      button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        background-color: rgb(224, 188, 32);
        color: black;
        border: none;
        border-radius: 8px;
        transition: background-color 0.3s ease, transform 0.2s ease;
      }
      button:hover {
        background-color: rgb(255, 215, 0);
        transform: scale(1.05);
      }
      button:active {
        transform: scale(0.95);
      }
      h1 {
        position: relative;
        top: 130px;
        font-size: 150px;        
        font-family: "Black Ops One";
        animation: colorCycle 5s infinite alternate;
        cursor: pointer;
      }

      @keyframes colorCycle {
        0% {
          color: #ff0000;
          text-shadow: 0 0 10px #ff0000;
        }
        25% {
          color: #ff7f00;
          text-shadow: 0 0 10px #ff7f00;
        }
        50% {
          color: #ffff00;
          text-shadow: 0 0 10px #ffff00;
        }
        75% {
          color: #00ff00;
          text-shadow: 0 0 10px #00ff00;
        }
        100% {
          color: #0000ff;
          text-shadow: 0 0 10px #0000ff;
        }
      }
      #greeting-game {
        font-family: 'Black Ops One';
        font-size: 55px;
        position: absolute;
        top: 3%;
        left: 40%;
        transform: translateX(-50%);
      }
      #restart-button {
        background-color: blue;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        position: relative;
        bottom: 20px;
        right: 20px;
      }
      #info-text {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 12px;
        text-align: center;
      }
      #triangle {
        width: 0;
        height: 0;
        border-left: 800px solid transparent;
        border-right: 30px solid transparent;
        border-bottom: 12px solid green;
        position: relative;
        top: 38%;
        left: 30%;
        transform: translate(-50%, -50%);
        z-index: 900;
      }
      #red-triangle {
        width: 0;
        height: 0;
        border-left: 650px solid transparent;
        border-right: 35px solid transparent;
        border-bottom: 10px solid rgb(160, 39, 61);
        position: relative;
        top: 55%;
        left: 25%;
        transform: translate(50%, 50%);
        z-index: 900;
      }
    </style>
  </head>
  <body>
    <div id="initial-screen">
      <div id="triangle"></div>
      <div id="red-triangle"></div>
      <img src="./images/som1.webp" alt="Game Logo" style="max-width: 100%; height: auto; position: absolute; top: 40; left: 50%; transform: translateX(-50%);" />
      <h1>Jogo Som e Ação</h1>
      <input type="text" id="playerName" placeholder="Digite seu nome" required />
      <button onclick="startGame()">Iniciar Jogo</button>
      <h2 id="greeting" style="display: none"></h2>
      <div id="info-text">
        SOFTWARE DE APOIO EDUCACIONAL PARA AUXÍLIO NO TRABALHO COM PORTADORES DO TRANSTORNO DO DÉFICIT DE ATENÇÃO E HIPERATIVIDADE (TDAH) <br />
        Projeto Integrador - UNIVESP - UNIVERSIDADE VIRTUAL DO ESTADO DE SÃO PAULO <br />
<span style="color: yellow; font-weight: bold;">Protótipo desenvolvido por grupo DRP03-PJI110-SALA 002-GRUPO 001</span>
      </div>
    </div>

    <div id="game-play-screen">
      <audio id="initial-audio" style="display: block; margin: 0 auto 20px auto; width: 300px; height: 40px;" autoplay>
        <source src="./som/march-of-super.mp3" type="audio/mpeg" />
        Seu navegador não suporta o elemento de áudio.
      </audio>
      <h2 id="greeting-game" style="display: none"></h2>
      <h2 style="color: rgb(174, 225, 161); font-weight: bold; position: absolute; top: 30%; left: 40%; transform: translate(-50%)">
        1º ► Ouça a música. <br /> 
        <br />
        2° ► Durante a música aperte a tecla "TOQUE (#)" para som curto ou a tecla "MELODIA (&)"  <br />
        som musical, de acordo com o tipo do som que você está ouvindo. <br />
        Altere a velocidade do audio se precisar. <br />
        <br />
        3° ► Monte a sua sequência de ações. <br />
        <br />
        4° ► Verifique se a sua sequência digitada está correta. <br />
        <br />
        5° ► Se a sua sequência estiver correta, parabéns, então aperte a tecla <br />
             "SIGA PARA O PRÓXIMO DESAFIO" e boa sorte em seu novo DESAFIO!!!.
      </h2>
      <img src="./images/som2.webp" alt="Background GIF" style="max-width: 100%; height: auto; position: absolute; top: 61%; left: 43%; transform: translateX(-50%);" />
      <img src="./images/1566507_d178c.gif" alt="New GIF" style="position: absolute; top: 60%; right: 08%; transform: translateY(-50%);" />
      <button id="instruction-button" style="background-color: red; color: white; font-weight: bold; position: absolute; left: 40%; top: 28%; font-size: 30px; transform: translate(-50%, -50%);" onclick="showInstructions()">
        COMO FAÇO PARA JOGAR?
      </button>
      <img src="./images/seta3.gif" alt="Seta" style="position: absolute; bottom: 15px; left: 80%; transform: translateX(-66%); width: 80px;">
      <button style="position: fixed; bottom: 30px; right: 20px; background-color: blue; color: white; padding: 10px 20px; font-size: 20px; cursor: pointer;" id="challenge-button" onclick="goToChallenge()">
        SIGA PARA O DESAFIO
      </button>
    </div>

    <div id="challenge-screen">
      <div id="player-name-display"></div>
      <div id="scoreboard">
        <div><strong>Pontuação:</strong> <span id="score-value">0</span></div>
        <div><strong>Tempo:</strong> <span id="time-value">00:00</span></div>
      </div>
      <h1 id="challenge-title" style="color: rgb(155, 239, 30); font-size: 100px; position: relative; left: 50px;">Desafio 1</h1>
      
      <audio id="challenge-audio" controls style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; height: 40px; z-index: 1100; border-radius: 8px; box-shadow: 0 0 10px rgb(224, 188, 32);">
        <source src="./som/Adams Family.mp3" type="audio/mpeg" />
        Seu navegador não suporta o elemento de áudio.
      </audio>

      <img src="./images/espiral.gif" alt="Imagem1" style="position: absolute; bottom: 50px; left: 20px; transform: translateX(1040%); width: 80px;">
      <img src="./images/martelo.gif" alt="Imagem2" style="position: absolute; bottom: 20px; left: 65px; transform: translateX(400%); width: 130px;">

      <div id="floating-menu">
        <button id="btn-restart" onclick="restartGame()">Reinicia Jogo</button>
      <button id="btn-check-sequence" onclick="checkSequence()">Verifica Sequência</button>
      <div id="sequence-result" style="position: fixed; top: 50%; right: 20px; transform: translateY(-50%); color: rgb(224, 188, 32); font-size: 24px; font-weight: bold; width: 350px; text-align: center; z-index: 1100;"></div>
      <button id="btn-next-challenge" disabled>Siga para Próximo Desafio</button>
      <script>
      function goToNextChallenge() {
        // Hide challenge screen
        document.getElementById("challenge-screen").style.display = "none";
        // Show screen 4
        document.getElementById("screen-4").style.display = "block";

        // Stop audio on screen 3
        const screen3Audio = document.getElementById("challenge-audio");
        if (screen3Audio) {
          screen3Audio.pause();
          screen3Audio.currentTime = 0;
        }

        // Play audio on screen 4 automatically
        const screen4Audio = document.getElementById("screen4-audio");
        if (screen4Audio) {
          screen4Audio.currentTime = 0;
          screen4Audio.play().catch(() => {
            // Autoplay might be blocked by browser, handle if needed
          });
        }

        // Add screen 3 score to screen 4 score
        const screen3Score = window.challengeScore || 0;
        const screen4ScoreValue = document.getElementById("score-value");
        if (screen4ScoreValue) {
          let screen4Score = parseInt(screen4ScoreValue.textContent) || 0;
          screen4Score = screen3Score;
          screen4ScoreValue.textContent = screen4Score;
        }

        // Set player name display on screen 4 - nome do jogador
        const playerName = document.getElementById("playerName").value;
        const playerNameDisplayScreen4 = document.querySelector("#screen-4 #player-name-display");
        if (playerNameDisplayScreen4) {
          playerNameDisplayScreen4.textContent = `Jogador ${playerName}`;
        }

        // Start the timer for challenge 2 screen
        startChallenge2Timer();
      }
=======
      function goToNextChallenge() {
        if (document.getElementById("screen-4").style.display === "block") {
          // Hide screen 4
          document.getElementById("screen-4").style.display = "none";
          // Show screen 5
          document.getElementById("screen-5").style.display = "block";
        } else {
          // Hide challenge screen
          document.getElementById("challenge-screen").style.display = "none";
          // Show screen 4
          document.getElementById("screen-4").style.display = "block";

          // Stop audio on screen 3
          const screen3Audio = document.getElementById("challenge-audio");
          if (screen3Audio) {
            screen3Audio.pause();
            screen3Audio.currentTime = 0;
          }

          // Play audio on screen 4 automatically
          const screen4Audio = document.getElementById("screen4-audio");
          if (screen4Audio) {
            screen4Audio.currentTime = 0;
            screen4Audio.play().catch(() => {
              // Autoplay might be blocked by browser, handle if needed
            });
          }

          // Add screen 3 score to screen 4 score
          const screen3Score = window.challengeScore || 0;
          const screen4ScoreValue = document.getElementById("score-value");
          if (screen4ScoreValue) {
            let screen4Score = parseInt(screen4ScoreValue.textContent) || 0;
            screen4Score = screen3Score;
            screen4ScoreValue.textContent = screen4Score;
          }

          // Set player name display on screen 4 - nome do jogador
          const playerName = document.getElementById("playerName").value;
          const playerNameDisplayScreen4 = document.querySelector("#screen-4 #player-name-display");
          if (playerNameDisplayScreen4) {
            playerNameDisplayScreen4.textContent = `Jogador ${playerName}`;
          }

          // Start the timer for challenge 2 screen
          startChallenge2Timer();
        }
      }

        document.getElementById("btn-next-challenge").onclick = goToNextChallenge;
      </script>
        <button id="btn-exit-game" onclick="exitGame()">Sair do Jogo</button>
      </div>      
      <div style="display: flex; align-items: center; gap: 40px; position: relative; top: 5%; left: 20px; transform: translateY(-30%); width: auto;">
        <div id="animated-rectangle" title="Retângulo Interativo"></div>
        <img id="secret-image" src="./images/secreto.png" alt="Imagem Secreta" />
        <table id="secret-sequence-table-3" style="border-collapse: collapse; user-select: none; width: 10%;">
          <caption style="color: rgb(224, 188, 32); font-weight: bold; font-size: 30px; margin-bottom: 10px;">SEQUÊNCIA SECRETA</caption>
          <tr><td class="secret-seq-cell">&amp;</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">&amp;</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">&amp;</td></tr>
          <tr><td class="secret-seq-cell">&amp;</td></tr>
          <tr><td class="secret-seq-cell">&amp;</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">&amp;</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
        </table>    

      <script>
        function copySecretSequence() {
          const secretTableScreen3 = document.querySelector("#challenge-screen #secret-sequence-table");
          const secretTableScreen4 = document.querySelector("#screen-4 #secret-sequence-table-4");
          if (secretTableScreen3 && secretTableScreen4) {
            secretTableScreen4.innerHTML = secretTableScreen3.innerHTML;
          }
        }

        // Call copySecretSequence when transitioning to screen 4
        document.getElementById("btn-next-challenge").addEventListener("click", () => {
          copySecretSequence();
        });
      </script>
        <table id="sequence-table-3" style="border-collapse: collapse; user-select: none; position: relative; top: -5%; left: 20px; transform: translateY(1%); width: auto;">
          <caption style="color: rgb(224, 188, 32); font-weight: bold; font-size: 30px; margin-bottom: 10px;">SEQUÊNCIA DO JOGADOR</caption>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
        </table>
      </div>
      <style>
        #animated-rectangle {
          width: 180px;
          height: 620px;
          background-color: rgba(77, 208, 240, 1);
          border-radius: 10px;
          margin-right: 20px;
          margin-bottom: 10px;
          position: absolute;
          top: 10%;
          cursor: pointer;
          animation: pulseGlow 2s infinite alternate;
          transition: transform 0.3s ease, background-color 0.3s ease;
          z-index: 1002;
        }
        #animated-rectangle:hover {
          background-color: rgba(77, 208, 240, 1);
          transform: scale(1.1);
          box-shadow: 0 0 15px rgba(77, 208, 240, 1);
        }
        @keyframes pulseGlow {
          0% {
            box-shadow: 0 0 10px rgba(77, 208, 240, 0.5);
          }
          100% {
            box-shadow: 0 0 25px rgba(77, 208, 240, 1);
          }
        }
        #secret-sequence-table1 .secret-seq-cell {
          text-align: center;
          font-weight: bold;
          font-size: 20px;
          background-color: black;
          color: rgb(224, 188, 32);
          border: 2px solid rgb(224, 188, 32);
          border-radius: 8px;
          margin: 2px;
          width: 30px;
          height: 30px;
          user-select: none;
          line-height: 40px;
        }
        #secret-image {
          position: absolute;
          top: 24%;
          left: -3%;
          width: 320px;
          height: 400px;
          pointer-events: none;
          z-index: 1003;
        }
      </style>
      <button id="clear-sequence" style="margin-top: 20px; background-color: #dc3545; color: white; font-weight: bold; padding: 6px 20px; border-radius: 8px; border: none; cursor: pointer; transition: background-color 0.3s ease; position: absolute; bottom: 40px; left: 283px;" onclick="clearSequence()">LIMPAR SEQUÊNCIA</button>

      <button id="melodia-button" onclick="melodiaAction()"><strong>MELODIA ( &amp; )</strong></button>
      <button id="toque-button" onclick="toqueAction()"><strong>TOQUE ( # )</strong></button>
    </div>
    <div id="screen-4" style="display:none; background-color: #111; color: #eee; padding: 20px; position: relative;">
      <div id="player-name-display"></div>
      <div id="scoreboard">
        <div><strong>Pontuação:</strong> <span id="score-value">0</span></div>
        <div><strong>Tempo:</strong> <span id="time-value">00:00</span></div>
      </div>
      <h1 id="challenge-title" style="color: rgb(155, 239, 30); font-size: 100px; position: relative; left: 50px;">Desafio 2</h1>
      
      <audio id="screen4-audio" controls autoplay style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; height: 40px; z-index: 1100; border-radius: 8px; box-shadow: 0 0 10px rgb(224, 188, 32);">
        <source src="./som/Pink panther.mp3" type="audio/mpeg" />
        Seu navegador não suporta o elemento de áudio.
      </audio>

      <img src="./images/espiral.gif" alt="Imagem1" style="position: absolute; bottom: 50px; left: 20px; transform: translateX(1040%); width: 80px;">
      <img src="./images/martelo.gif" alt="Imagem2" style="position: absolute; bottom: 20px; left: 65px; transform: translateX(400%); width: 130px;">

      <div id="floating-menu">
        <button id="btn-restart" onclick="restartGame()">Reinicia Jogo</button>
      <button id="btn-check-sequence" onclick="checkSequence()">Verifica Sequência</button>
      <div id="sequence-result" style="position: fixed; top: 50%; right: 20px; transform: translateY(-50%); color: rgb(224, 188, 32); font-size: 24px; font-weight: bold; width: 350px; text-align: center; z-index: 1100;"></div>
        <button id="btn-next-challenge" onclick="goToNextChallenge()">Siga para Próximo Desafio</button>
        <button id="btn-exit-game" onclick="exitGame()">Sair do Jogo</button>
      </div>      
      <div style="display: flex; align-items: center; gap: 40px; position: relative; top: -5%; left: 20px; transform: translateY(-30%); width: auto;">
        <div id="animated-rectangle" title="Retângulo Interativo"></div>
        <img id="secret-image" src="./images/secreto.png" alt="Imagem Secreta" />
        <table id="secret-sequence-table-4" style="border-collapse: collapse; user-select: none; width: 10%;">
          <caption style="color: rgb(224, 188, 32); font-weight: bold; font-size: 30px; margin-bottom: 10px;">SEQUÊNCIA SECRETA</caption>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">#</td></tr>
          <tr><td class="secret-seq-cell">&amp;</td></tr>
        </table>    
        <table id="sequence-table-4" style="border-collapse: collapse; user-select: none; position: relative; top: -5%; left: 20px; transform: translateY(1%); width: auto;">
          <caption style="color: rgb(224, 188, 32); font-weight: bold; font-size: 30px; margin-bottom: 10px;">SEQUÊNCIA DO JOGADOR</caption>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
          <tr><td><input type="text" maxlength="1" class="seq-input" /></td></tr>
        </table>
      </div>
      <style>
        #animated-rectangle-3 {
          width: 90px;
          height: 300px;
          background-color: rgba(77, 208, 240, 0.7);
          border-radius: 10px;
          margin-right: 20px;
          margin-bottom: 10px;
          position: absolute;
          top: 15%;
          cursor: pointer;
          animation: pulseGlow 2s infinite alternate;
          transition: transform 0.3s ease, background-color 0.3s ease;
          z-index: 1002;
        }
        #animated-rectangle-3:hover {
          background-color: rgba(77, 208, 240, 0.8);
          transform: scale(1.1);
          box-shadow: 0 0 15px rgba(77, 208, 240, 0.9);
        }
        @keyframes pulseGlow {
          0% {
            box-shadow: 0 0 10px rgba(77, 208, 240, 0.5);
          }
          100% {
            box-shadow: 0 0 25px rgba(77, 208, 240, 1);
          }
        }
        #secret-sequence-table-3 .secret-seq-cell {
          text-align: center;
          font-weight: bold;
          font-size: 20px;
          background-color: black;
          color: rgb(224, 188, 32);
          border: 2px solid rgb(224, 188, 32);
          border-radius: 8px;
          margin: 2px;
          width: 30px;
          height: 30px;
          user-select: none;
          line-height: 40px;
        }
        #secret-image-3 {
          position: absolute;
          top: 24%;
          left: -3%;
          width: 320px;
          height: 400px;
          pointer-events: none;
          z-index: 1003;
        }
      </style>
      <button id="clear-sequence" style="margin-top: 20px; background-color: #dc3545; color: white; font-weight: bold; padding: 6px 20px; border-radius: 8px; border: none; cursor: pointer; transition: background-color 0.3s ease; position: absolute; bottom: 40px; left: 270px;" onclick="clearSequence()">LIMPAR SEQUÊNCIA</button>

      <button id="melodia-button" onclick="melodiaAction()"><strong>MELODIA ( &amp; )</strong></button>
      <button id="toque-button" onclick="toqueAction()"><strong>TOQUE ( # )</strong></button>
      <div id="floating-menu">
        <button id="btn-restart" onclick="restartGame()">Reinicia Jogo</button>
      <button id="btn-check-sequence" onclick="checkSequence()">Verifica Sequência</button>
      <div id="sequence-result" style="position: fixed; top: 50%; right: 20px; transform: translateY(-50%); color: rgb(224, 188, 32); font-size: 24px; font-weight: bold; width: 350px; text-align: center; z-index: 1100;"></div>
        <button id="btn-next-challenge" onclick="goToNextChallenge()">Siga para Próximo Desafio</button>
        <button id="btn-exit-game" onclick="exitGame()">Sair do Jogo</button>
    </div>
    <script>
        document.getElementById("initial-screen").style.display = "block";

        // Request fullscreen on page load for initial screen
        window.addEventListener('load', () => {
          const elem = document.documentElement;
          if (elem.requestFullscreen) {
            elem.requestFullscreen();
          } else if (elem.mozRequestFullScreen) { /* Firefox */
            elem.mozRequestFullScreen();
          } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
            elem.webkitRequestFullscreen();
          } else if (elem.msRequestFullscreen) { /* IE/Edge */
            elem.msRequestFullscreen();
          }

          const initialAudio = document.getElementById("initial-audio");
          if (initialAudio) {
            setTimeout(() => {
              initialAudio.muted = false;
              initialAudio.play().catch(() => {
                // Autoplay might be blocked by browser, handle if needed
              });
            }, 3000);
          }

          // Start timer automatically if screen-4 is visible on page load
          const screen4 = document.getElementById("screen-4");
          if (screen4 && screen4.style.display !== "none") {
            if (typeof startChallenge2Timer === "function") {
              startChallenge2Timer();
            }
          }
        });

      function startGame() {
        const playerName = document.getElementById("playerName").value;
        document.getElementById("greeting").textContent = `${playerName}, seja bem vindo ao Jogo SOM E AÇÃO!!!`;
        document.getElementById("greeting").style.display = "block";
        document.getElementById("greeting-game").textContent = `${playerName}, seja bem vindo ao Jogo SOM E AÇÃO!!!`;
        document.getElementById("greeting-game").style.display = "block";
        document.getElementById("initial-screen").style.display = "none";
        document.getElementById("game-play-screen").style.display = "flex";

        // Play the audio on screen 2 automatically
        const initialAudio = document.getElementById("initial-audio");
        if (initialAudio) {
          initialAudio.muted = false;
          initialAudio.play().catch(() => {
            // Autoplay might be blocked by browser, handle if needed
          });
        }

        // Request fullscreen mode for the document body
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) { /* Firefox */
          elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) { /* IE/Edge */
          elem.msRequestFullscreen();
        }
      }

      function restartGame() {
        // Hide all game screens except initial screen
        document.getElementById("game-play-screen").style.display = "none";
        document.getElementById("challenge-screen").style.display = "none";
        document.getElementById("screen-4").style.display = "none";
        document.getElementById("screen-5").style.display = "none";
        document.getElementById("initial-screen").style.display = "block";

        // Clear player name input and greetings
        document.getElementById("playerName").value = "";
        document.getElementById("greeting").style.display = "none";
        document.getElementById("greeting-game").style.display = "none";

        // Clear sequence inputs on challenge screen
        const seqInputs = document.querySelectorAll("#sequence-table-3 .seq-input");
        seqInputs.forEach(input => input.value = "");

        // Reset score and timer display
        const scoreValue = document.getElementById("score-value");
        const timeValue = document.getElementById("time-value");
        if (scoreValue) scoreValue.textContent = "0";
        if (timeValue) timeValue.textContent = "00:00";

        // Reset global score and timer variables
        window.challengeScore = 0;
        window.challengeTimerSeconds = 0;
        if (window.challengeTimerInterval) {
          clearInterval(window.challengeTimerInterval);
          window.challengeTimerInterval = null;
        }

        // Pause and reset challenge audio
        const challengeAudio = document.getElementById("challenge-audio");
        if (challengeAudio) {
          challengeAudio.pause();
          challengeAudio.currentTime = 0;
        }
      }

      function goToChallenge() {
        document.getElementById("game-play-screen").style.display = "none";
        document.getElementById("challenge-screen").style.display = "block";

        // Request fullscreen mode for the document body
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) { /* Firefox */
          elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) { /* IE/Edge */
          elem.msRequestFullscreen();
        }

        const initialAudio = document.getElementById("initial-audio");
        if (initialAudio) {
          initialAudio.pause();
          initialAudio.currentTime = 0;
        }

        const audio = document.getElementById("challenge-audio");
        let playCount = 0;

        audio.addEventListener('ended', function() {
          playCount++;
          if (playCount < 1) {
            audio.currentTime = 0;
            audio.play();
          } else {
            audio.pause();
          }
        });

        audio.play();

        // Set player name display on challenge screen - nome do jogador
        const playerName = document.getElementById("playerName").value;
        const playerNameDisplay = document.getElementById("player-name-display");
        playerNameDisplay.textContent = `Jogador ${playerName}`;

        // Initialize scoreboard - placar
        const scoreValue = document.getElementById("score-value");
        const timeValue = document.getElementById("time-value");
        let score = 0;
        let seconds = 0;
        let timerInterval;

        function updateTimer() {
          seconds++;
          const mins = Math.floor(seconds / 60);
          const secs = seconds % 60;
          timeValue.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Reset score and time - reset placar e tempo
        score = 0;
        scoreValue.textContent = score;
        seconds = 0;
        timeValue.textContent = "00:00";

        // Clear any existing timer - limpa o tempo de jogo
        if (timerInterval) {
          clearInterval(timerInterval);
        }

        // Start timer interval
        timerInterval = setInterval(updateTimer, 1000);

        // Store timerInterval globally to clear later if needed
        window.challengeTimerInterval = timerInterval;
        window.challengeScore = score;
        window.updateScore = function(points) {
          window.challengeScore += points;
          scoreValue.textContent = window.challengeScore;
        };
      }
    </script>

    <style>
      #floating-menu {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: rgba(0, 0, 0, 0.7);
        border-radius: 10px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 1000;
      }
      #floating-menu button {
        color: white;
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.3s ease;
      }
      #btn-restart {
        background-color: #1e90ff;
      }
      #btn-restart:hover {
        background-color: #63b3ed;
      }
      #btn-check-sequence {
        background-color: #28a745;
      }
      #btn-check-sequence:hover {
        background-color: #5cd65c;
      }
      #btn-next-challenge {
        background-color: #ff8c00;
      }
      #btn-next-challenge:hover {
        background-color: #ffb84d;
      }
      #btn-exit-game {
        background-color: #dc3545;
      }
      #btn-exit-game:hover {
        background-color: #e57373;
      }
    </style>

    <script>
      // Make scoreboard draggable
      const scoreboard = document.getElementById('scoreboard');
      let isDragging = false;
      let dragOffsetX = 0;
      let dragOffsetY = 0;

      scoreboard.addEventListener('mousedown', (e) => {
        isDragging = true;
        dragOffsetX = e.clientX - scoreboard.offsetLeft;
        dragOffsetY = e.clientY - scoreboard.offsetTop;
        scoreboard.style.transition = 'none';
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
        scoreboard.style.transition = '';
      });

      document.addEventListener('mousemove', (e) => {
        if (isDragging) {
          let newX = e.clientX - dragOffsetX;
          let newY = e.clientY - dragOffsetY;

          // Keep scoreboard within viewport bounds
          const maxX = window.innerWidth - scoreboard.offsetWidth;
          const maxY = window.innerHeight - scoreboard.offsetHeight;
          newX = Math.max(0, Math.min(newX, maxX));
          newY = Math.max(0, Math.min(newY, maxY));

          scoreboard.style.left = newX + 'px';
          scoreboard.style.top = newY + 'px';
        }
      });

      function goToNextChallenge() {
        // Hide challenge screen
        document.getElementById("challenge-screen").style.display = "none";
        // Show screen 4
        document.getElementById("screen-4").style.display = "block";
      }

      function exitGame() {
        // Try to close the window/tab
        window.close();

        // If window.close() is blocked, fallback to hiding all screens and showing a goodbye message
        setTimeout(() => {
          // Check if window is still open by checking document visibility
          if (!document.hidden) {
            // Hide all main screens
            const screens = [
              "initial-screen",
              "game-play-screen",
              "challenge-screen",
              "screen-4",
              "screen-5"
            ];
            screens.forEach(id => {
              const el = document.getElementById(id);
              if (el) el.style.display = "none";
            });

            // Create or show a goodbye message div
            let goodbyeDiv = document.getElementById("goodbye-message");
            if (!goodbyeDiv) {
              goodbyeDiv = document.createElement("div");
              goodbyeDiv.id = "goodbye-message";
              goodbyeDiv.style.position = "fixed";
              goodbyeDiv.style.top = "50%";
              goodbyeDiv.style.left = "50%";
              goodbyeDiv.style.transform = "translate(-50%, -50%)";
              goodbyeDiv.style.color = "rgb(224, 188, 32)";
              goodbyeDiv.style.fontSize = "40px";
              goodbyeDiv.style.fontFamily = "Fantasy";
              goodbyeDiv.style.textAlign = "center";
              goodbyeDiv.style.zIndex = "3000";
              goodbyeDiv.textContent = "Obrigado por jogar! Até a próxima!";
              document.body.appendChild(goodbyeDiv);
            } else {
              goodbyeDiv.style.display = "block";
            }
          }
        }, 500);
      }

      function goToNextChallenge() {
        // Hide challenge screen
        document.getElementById("challenge-screen").style.display = "none";
        // Show screen 4
        document.getElementById("screen-4").style.display = "block";
         // Show screen 5
         document.getElementById("screen-5").style.display = "block";

        // Stop audio on screen 3
        const screen3Audio = document.getElementById("challenge-audio");
        if (screen3Audio) {
          screen3Audio.pause();
          screen3Audio.currentTime = 0;
        }

        // Play audio on screen 4 automatically
        const screen4Audio = document.getElementById("screen4-audio");
        if (screen4Audio) {
          screen4Audio.currentTime = 0;
          screen4Audio.play().catch(() => {
            // Autoplay might be blocked by browser, handle if needed
          });
        }

        // Add screen 3 score to screen 4 score
        const screen3Score = window.challengeScore || 0;
        const screen4ScoreValue = document.getElementById("score-value");
        if (screen4ScoreValue) {
          let screen4Score = parseInt(screen4ScoreValue.textContent) || 0;
          screen4Score = screen3Score;
          screen4ScoreValue.textContent = screen4Score;
        }

        // Set player name display on screen 4 - nome do jogador
        const playerName = document.getElementById("playerName").value;
        const playerNameDisplayScreen4 = document.querySelector("#screen-4 #player-name-display");
        if (playerNameDisplayScreen4) {
          playerNameDisplayScreen4.textContent = `Jogador ${playerName}`;
        }

        // Start the timer for challenge 2 screen
        startChallenge2Timer();
      }

      function startChallenge2Timer() {
        const screen4TimeValue = document.getElementById("time-value");
        if (screen4TimeValue) {
          let totalSeconds = 0;
          const timeParts = screen4TimeValue.textContent.split(":");
          if (timeParts.length === 2) {
            totalSeconds = parseInt(timeParts[0]) * 60 + parseInt(timeParts[1]);
          }
          totalSeconds += window.challengeTimerSeconds || 0;

          function updateTimer() {
            totalSeconds++;
            const mins = Math.floor(totalSeconds / 60);
            const secs = totalSeconds % 60;
            screen4TimeValue.textContent = `${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
            window.challengeTimerSeconds = totalSeconds;
          }

          if (window.challengeTimerInterval) {
            clearInterval(window.challengeTimerInterval);
          }
          updateTimer();
          window.challengeTimerInterval = setInterval(updateTimer, 1000);
        }
      }

      document.getElementById("btn-next-challenge").onclick = goToNextChallenge;

      function clearSequence() {
        let inputs;
        if (document.getElementById("challenge-screen").style.display === "block") {
          inputs = document.querySelectorAll("#sequence-table-3 .seq-input");
        } else if (document.getElementById("screen-4").style.display === "block") {
          inputs = document.querySelectorAll("#sequence-table-4 .seq-input");
        } else {
          inputs = [];
        }
        inputs.forEach(input => input.value = "");
        // Reset score to zero when clearing sequence
        const scoreValue = document.getElementById("score-value");
        if (scoreValue) {
          scoreValue.textContent = "0";
        }
        // Also reset the global score variable if exists
        if (window.challengeScore !== undefined) {
          window.challengeScore = 0;
        }
      }

      function checkSequence() {
        let secretCells, playerInputs;
        if (document.getElementById("challenge-screen").style.display === "block") {
          secretCells = document.querySelectorAll("#secret-sequence-table-3 .secret-seq-cell");
          playerInputs = document.querySelectorAll("#sequence-table-3 .seq-input");
        } else if (document.getElementById("screen-4").style.display === "block") {
          secretCells = document.querySelectorAll("#secret-sequence-table-4 .secret-seq-cell");
          playerInputs = document.querySelectorAll("#sequence-table-4 .seq-input");
        } else {
          secretCells = [];
          playerInputs = [];
        }
        let secretSequence = "";
        let playerSequence = "";

        secretCells.forEach(cell => {
          secretSequence += cell.textContent.trim();
        });

        playerInputs.forEach(input => {
          playerSequence += input.value.trim();
        });

        // Calculate score based on correct characters
        let scoreIncrement = 0;
        for (let i = 0; i < Math.min(secretSequence.length, playerSequence.length); i++) {
          if (secretSequence[i] === playerSequence[i]) {
            scoreIncrement += 10;
          }
        }
        window.updateScore(scoreIncrement);

        const resultDiv = document.getElementById("sequence-result");
        const nextChallengeBtn = document.getElementById("btn-next-challenge");
        if (secretSequence === playerSequence) {
          resultDiv.innerHTML = '<span id="success-message" tabindex="0" role="button" aria-label="Parabéns, você acertou a sequência. Siga para o próximo desafio.">PARABÉNS, VOCÊ ACERTOU A SEQUÊNCIA... SIGA PARA O PRÓXIMO DESAFIO!!!</span>';
          resultDiv.style.color = "green";
          resultDiv.style.position = "fixed";
          resultDiv.style.top = "50%";
          resultDiv.style.right = "0";
          resultDiv.style.transform = "translateY(-50%)";
          resultDiv.style.width = "350px";
          resultDiv.style.textAlign = "center";
          resultDiv.style.fontWeight = "bold";
          resultDiv.style.fontSize = "30px";
          if (nextChallengeBtn) {
            nextChallengeBtn.disabled = false;
          }
          const successMessage = document.getElementById("success-message");
          successMessage.onclick = function() {
            if (nextChallengeBtn) {
              nextChallengeBtn.click();
            } else {
              alert("Função Siga para Próximo Desafio ainda não implementada.");
            }
          };
          successMessage.onkeydown = function(e) {
            if (e.key === "Enter" || e.key === " ") {
              successMessage.click();
            }
          };
        } else {
          resultDiv.innerHTML = '<span id="error-message" tabindex="0" role="button" aria-label="Você errou a sequência. Tente novamente.">VOCÊ ERROU A SEQUÊNCIA... TENTE NOVAMENTE.</span>';
          resultDiv.style.color = "red";
          resultDiv.style.position = "fixed";
          resultDiv.style.top = "50%";
          resultDiv.style.right = "0";
          resultDiv.style.transform = "translateY(-50%)";
          resultDiv.style.width = "350px";
          resultDiv.style.textAlign = "center";
          resultDiv.style.fontWeight = "bold";
          resultDiv.style.fontSize = "30px";
          if (nextChallengeBtn) {
            nextChallengeBtn.disabled = true;
          }
          const errorMessage = document.getElementById("error-message");
          errorMessage.onclick = function() {
            clearSequence();
            resultDiv.textContent = "";
          };
          errorMessage.onkeydown = function(e) {
            if (e.key === "Enter" || e.key === " ") {
              errorMessage.click();
            }
          };
        }
      }
      </script>

    <style>
      #melodia-button {
        position: absolute;
       top: 75%;
        left: 56%;
        transform: translate(-50%, -50%);
        background-color: #1b0791;
        color: white;
        padding: 12px 24px;
        font-size: 18px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.6);
        transition: background-color 0.3s ease, transform 0.2s ease;
        z-index: 1100;
      }
      #melodia-button:hover {
        background-color: #e57373;
        transform: scale(1.05);
      }
      #melodia-button:active {
        transform: scale(0.95);
      }
      #melodia-button strong {
        font-weight: bold;
      }
      @keyframes moveButton {
        0% { transform: translate(0, 0); }
        25% { transform: translate(5px, 0); }
        50% { transform: translate(-5px, 0); }
        75% { transform: translate(5px, 0); }
        100% { transform: translate(0, 0); }
      }
      #toque-button {
        position: absolute;
        top: 75%;
        left: 45%;
        transform: translate(-50%, -50%);
        background-color: #7a0404;
        color: white;
        padding: 12px 24px;
        font-size: 18px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.6);
        transition: background-color 0.3s ease, transform 0.2s ease;
        z-index: 1100;
      }
      #toque-button:hover {
        background-color: #e57373;
        transform: scale(1.05);
      }
      #toque-button:active {
        transform: scale(0.95);
      }
      #toque-button strong {
        font-weight: bold;
      }
    </style>

      <script>
      function melodiaAction() {
        let inputs;
        if (document.getElementById("challenge-screen").style.display === "block") {
          inputs = document.querySelectorAll("#sequence-table-3 .seq-input");
        } else if (document.getElementById("screen-4").style.display === "block") {
          inputs = document.querySelectorAll("#sequence-table-4 .seq-input");
        } else {
          inputs = [];
        }
        for (let input of inputs) {
          if (input.value === "") {
            input.value = "&";
            break;
          }
        }
      }
      </script>

      <script>
      function toqueAction() {
        let inputs;
        if (document.getElementById("challenge-screen").style.display === "block") {
          inputs = document.querySelectorAll("#sequence-table-3 .seq-input");
        } else if (document.getElementById("screen-4").style.display === "block") {
          inputs = document.querySelectorAll("#sequence-table-4 .seq-input");
        } else {
          inputs = [];
        }
        for (let input of inputs) {
          if (input.value === "") {
            input.value = "#";
            break;
          }
        }
      }
      </script>
    <div id="screen-5" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: black; overflow: hidden; z-index: 2000; display: flex; align-items: center;">
      <img src="./images/construcao.gif" alt="Construção" style="height: 50vh; margin-left: 20px; object-fit: contain;" />
      <h1 id="construction-text" style="font-family: 'Black Ops One', cursive; font-size: 70px; color: #ff0000; position: relative; left: 800px; cursor: pointer; user-select: none; animation: colorCycle 5s infinite alternate; flex-grow: 1;">
        PROTÓTIPO EM CONSTRUÇÃO!!!
      </h1>
    </div>

    <style>
      @keyframes floatMove {
        0% { transform: translateY(0); }
        50% { transform: translateY(-20px); }
        100% { transform: translateY(0); }
      }
      #construction-text {
        animation: colorCycle 5s infinite alternate, floatMove 4s infinite ease-in-out;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translateX(-50%);
      }
    </style>

    <script>
      const constructionText = document.getElementById('construction-text');
      let posY = window.innerHeight / 2;
      let directionY = 1;
      const speed = 2;

      function moveText() {
        const rect = constructionText.getBoundingClientRect();
        if (posY + rect.height >= window.innerHeight || posY <= 0) directionY *= -1;
        posY += speed * directionY;
        constructionText.style.top = posY + 'px';
        requestAnimationFrame(moveText);
      }

      constructionText.addEventListener('mouseenter', () => {
        directionY = -directionY;
      });

      moveText();
    </script>
  </body>
</html>
